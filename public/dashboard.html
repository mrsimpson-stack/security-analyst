<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .whatsapp-gradient { background: linear-gradient(135deg, #25D366 0%, #128C7E 100%); }
        .message-sent { background: #DCF8C6; color: #000; border-radius: 18px 18px 0 18px; }
        .message-received { background: #FFFFFF; color: #000; border-radius: 18px 18px 18px 0; }
        .typing-indicator { display: flex; align-items: center; }
        .typing-dot { width: 8px; height: 8px; margin: 0 2px; background: #888; border-radius: 50%; animation: typing 1.4s infinite; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 60%, 100% { transform: translateY(0); } 30% { transform: translateY(-10px); } }
        .online-dot { width: 8px; height: 8px; background: #4CAF50; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- WhatsApp Dashboard -->
    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="w-80 bg-gray-800 border-r border-gray-700 flex flex-col">
            <!-- User Profile -->
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center mb-4">
                    <div class="relative">
                        <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center mr-3">
                            <i class="fab fa-whatsapp text-white text-2xl"></i>
                        </div>
                        <div class="online-dot absolute bottom-0 right-3 border-2 border-gray-800"></div>
                    </div>
                    <div class="flex-1">
                        <div class="font-bold text-lg" id="userName">WhatsApp User</div>
                        <div class="text-sm text-green-400">● Online</div>
                    </div>
                    <button onclick="toggleSidebar()" class="lg:hidden p-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="text-sm text-gray-400">
                    <div>Phone: <span id="userPhone" class="font-mono">+256 712 345 678</span></div>
                    <div>Session: <span id="sessionId" class="font-mono text-green-400">WA-123456</span></div>
                </div>
            </div>

            <!-- Search -->
            <div class="p-4 border-b border-gray-700">
                <div class="relative">
                    <input type="text" id="searchChats" 
                           class="w-full p-3 pl-10 bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                           placeholder="Search chats...">
                    <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                </div>
            </div>

            <!-- Chats List -->
            <div class="flex-1 overflow-y-auto" id="chatsList">
                <div class="p-4">
                    <div class="text-gray-400 text-sm font-bold mb-3">RECENT CHATS</div>
                    <!-- Chats will be loaded here -->
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-comments text-3xl mb-3"></i>
                        <p>No chats yet</p>
                    </div>
                </div>
            </div>

            <!-- Bottom Menu -->
            <div class="p-4 border-t border-gray-700">
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="showSection('messages')" class="menu-btn active p-3 rounded-lg text-green-400">
                        <i class="fas fa-comments text-xl"></i>
                    </button>
                    <button onclick="showSection('contacts')" class="menu-btn p-3 rounded-lg text-gray-400 hover:text-white">
                        <i class="fas fa-users text-xl"></i>
                    </button>
                    <button onclick="showSection('media')" class="menu-btn p-3 rounded-lg text-gray-400 hover:text-white">
                        <i class="fas fa-image text-xl"></i>
                    </button>
                    <button onclick="showSection('settings')" class="menu-btn p-3 rounded-lg text-gray-400 hover:text-white">
                        <i class="fas fa-cog text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 flex flex-col">
            <!-- Top Bar -->
            <div class="p-4 border-b border-gray-700 flex justify-between items-center">
                <div class="flex items-center">
                    <button onclick="toggleSidebar()" class="lg:hidden p-2 mr-3">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div>
                        <h2 class="text-xl font-bold" id="activeChatName">Select a chat</h2>
                        <div class="text-sm text-gray-400" id="activeChatStatus">Tap on a chat to start messaging</div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <div class="hidden md:flex items-center space-x-4">
                        <div class="bg-green-900 text-green-300 px-3 py-1.5 rounded-lg text-sm">
                            <i class="fas fa-shield-alt"></i> Encrypted
                        </div>
                        <div class="text-sm text-gray-400">
                            <i class="fas fa-sync-alt"></i> <span id="lastSync">Just now</span>
                        </div>
                    </div>
                    <div class="relative">
                        <button onclick="toggleNotifications()" class="p-2 relative">
                            <i class="fas fa-bell"></i>
                            <span id="notificationCount" class="absolute -top-1 -right-1 bg-red-500 text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                        </button>
                        <div id="notificationsPanel" class="hidden absolute right-0 mt-2 w-80 bg-gray-800 rounded-lg shadow-xl z-50 border border-gray-700">
                            <div class="p-4 border-b border-gray-700">
                                <div class="flex justify-between items-center">
                                    <h3 class="font-bold">Notifications</h3>
                                    <button onclick="clearNotifications()" class="text-sm text-gray-400 hover:text-white">Clear all</button>
                                </div>
                            </div>
                            <div id="notificationsList" class="max-h-64 overflow-y-auto">
                                <!-- Notifications will appear here -->
                            </div>
                        </div>
                    </div>
                    <button onclick="showSettings()" class="p-2">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
            </div>

            <!-- Messages Area -->
            <div class="flex-1 flex flex-col">
                <!-- Sections Container -->
                <div id="sectionsContainer">
                    <!-- Messages Section (Default) -->
                    <div id="messagesSection" class="flex-1 flex flex-col h-full">
                        <!-- Messages Container -->
                        <div class="flex-1 overflow-y-auto p-4 bg-gray-900" id="messagesContainer">
                            <div class="text-center py-12">
                                <div class="w-24 h-24 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <i class="fab fa-whatsapp text-green-500 text-4xl"></i>
                                </div>
                                <h3 class="text-2xl font-bold mb-3">Welcome to WhatsApp Web</h3>
                                <p class="text-gray-400 mb-6">Select a chat to start messaging</p>
                                <div class="max-w-md mx-auto grid grid-cols-2 gap-4">
                                    <button onclick="newChat()" class="p-4 bg-gray-800 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-plus text-green-400 text-xl mb-2"></i>
                                        <div class="font-bold">New Chat</div>
                                    </button>
                                    <button onclick="importContacts()" class="p-4 bg-gray-800 rounded-lg hover:bg-gray-700">
                                        <i class="fas fa-users text-blue-400 text-xl mb-2"></i>
                                        <div class="font-bold">Import Contacts</div>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Message Input -->
                        <div class="p-4 border-t border-gray-700 bg-gray-800">
                            <div class="flex items-center space-x-3">
                                <button class="p-3 text-gray-400 hover:text-white">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button class="p-3 text-gray-400 hover:text-white">
                                    <i class="fas fa-image"></i>
                                </button>
                                <button class="p-3 text-gray-400 hover:text-white">
                                    <i class="fas fa-camera"></i>
                                </button>
                                <div class="flex-1">
                                    <input type="text" id="messageInput" 
                                           class="w-full p-3 bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                           placeholder="Type a message..."
                                           disabled>
                                </div>
                                <button id="sendButton" onclick="sendMessage()" 
                                        class="whatsapp-gradient p-3 rounded-lg hover:opacity-90" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Contacts Section -->
                    <div id="contactsSection" class="hidden h-full">
                        <div class="p-6">
                            <h2 class="text-2xl font-bold mb-6">
                                <i class="fas fa-users text-blue-400"></i> Contacts
                            </h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="contactsList">
                                <!-- Contacts will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Media Section -->
                    <div id="mediaSection" class="hidden h-full">
                        <div class="p-6">
                            <h2 class="text-2xl font-bold mb-6">
                                <i class="fas fa-image text-purple-400"></i> Media
                            </h2>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="mediaGrid">
                                <!-- Media will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Settings Section -->
                    <div id="settingsSection" class="hidden h-full">
                        <div class="p-6 max-w-2xl">
                            <h2 class="text-2xl font-bold mb-6">
                                <i class="fas fa-cog text-yellow-400"></i> Settings
                            </h2>
                            
                            <div class="space-y-6">
                                <!-- Account Settings -->
                                <div class="bg-gray-800 rounded-xl p-6">
                                    <h3 class="text-lg font-bold mb-4">Account</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-gray-400 mb-2">Phone Number</label>
                                            <div class="flex items-center">
                                                <input type="text" id="settingsPhone" 
                                                       class="flex-1 p-3 bg-gray-700 rounded-lg" readonly>
                                                <button onclick="copyPhone()" class="ml-3 p-3 bg-gray-700 rounded-lg hover:bg-gray-600">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-gray-400 mb-2">Session ID</label>
                                            <div class="flex items-center">
                                                <input type="text" id="settingsSession" 
                                                       class="flex-1 p-3 bg-gray-700 rounded-lg" readonly>
                                                <button onclick="copySession()" class="ml-3 p-3 bg-gray-700 rounded-lg hover:bg-gray-600">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Auto-Reply Settings -->
                                <div class="bg-gray-800 rounded-xl p-6">
                                    <h3 class="text-lg font-bold mb-4">Auto-Reply</h3>
                                    <div class="space-y-4">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <div class="font-bold">Enable Auto-Reply</div>
                                                <div class="text-sm text-gray-400">Automatically reply to messages</div>
                                            </div>
                                            <label class="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" id="autoReplyToggle" class="sr-only peer">
                                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                            </label>
                                        </div>
                                        <div id="autoReplySettings" class="hidden">
                                            <textarea id="autoReplyMessage" 
                                                      class="w-full p-3 bg-gray-700 rounded-lg"
                                                      placeholder="Enter auto-reply message..."
                                                      rows="3"></textarea>
                                            <div class="flex justify-end mt-3">
                                                <button onclick="saveAutoReply()" class="px-4 py-2 bg-green-600 rounded-lg hover:bg-green-700">
                                                    Save
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Export Settings -->
                                <div class="bg-gray-800 rounded-xl p-6">
                                    <h3 class="text-lg font-bold mb-4">Export Data</h3>
                                    <div class="grid grid-cols-2 gap-4">
                                        <button onclick="exportChats('json')" class="p-4 bg-gray-700 rounded-lg hover:bg-gray-600">
                                            <i class="fas fa-file-code text-green-400 text-xl mb-2"></i>
                                            <div class="font-bold">Export JSON</div>
                                        </button>
                                        <button onclick="exportChats('csv')" class="p-4 bg-gray-700 rounded-lg hover:bg-gray-600">
                                            <i class="fas fa-file-csv text-blue-400 text-xl mb-2"></i>
                                            <div class="font-bold">Export CSV</div>
                                        </button>
                                    </div>
                                </div>

                                <!-- Danger Zone -->
                                <div class="bg-red-900/20 border border-red-700 rounded-xl p-6">
                                    <h3 class="text-lg font-bold mb-4 text-red-400">Danger Zone</h3>
                                    <div class="space-y-4">
                                        <button onclick="logout()" class="w-full p-4 bg-red-700 rounded-lg hover:bg-red-600">
                                            <i class="fas fa-sign-out-alt"></i> Logout
                                        </button>
                                        <button onclick="deleteSession()" class="w-full p-4 bg-red-900 rounded-lg hover:bg-red-800">
                                            <i class="fas fa-trash"></i> Delete Session
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="p-3 border-t border-gray-700 bg-gray-800 text-sm text-gray-400 flex justify-between">
                <div>
                    <span id="connectionStatus">● Connected</span>
                    <span class="mx-2">|</span>
                    <span id="messageCount">0 messages</span>
                </div>
                <div>
                    <span id="currentTime">Loading...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="newChatModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">New Chat</h3>
            <input type="text" id="newChatInput" 
                   class="w-full p-3 bg-gray-700 rounded-lg mb-4" 
                   placeholder="Enter phone number or name">
            <div class="flex justify-end space-x-3">
                <button onclick="closeModal('newChatModal')" class="px-4 py-2 bg-gray-700 rounded-lg hover:bg-gray-600">
                    Cancel
                </button>
                <button onclick="createNewChat()" class="px-4 py-2 whatsapp-gradient rounded-lg hover:opacity-90">
                    Start Chat
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Global variables
        let currentSession = null;
        let activeChat = null;
        let chats = [];
        let notifications = [];
        
        // Initialize dashboard
        async function initDashboard() {
            // Get session from URL
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session');
            
            if (!sessionId) {
                window.location.href = '/session';
                return;
            }
            
            try {
                // Load session data
                const response = await fetch(`/api/session?sessionId=${sessionId}`);
                const data = await response.json();
                
                if (data.success && data.session.status === 'linked') {
                    currentSession = data.session;
                    
                    // Update UI
                    document.getElementById('userPhone').textContent = formatPhoneNumber(data.session.phoneNumber);
                    document.getElementById('sessionId').textContent = sessionId;
                    document.getElementById('settingsPhone').value = data.session.phoneNumber;
                    document.getElementById('settingsSession').value = sessionId;
                    
                    // Load initial data
                    loadChats();
                    loadNotifications();
                    updateTime();
                    updateLastSync();
                    
                    // Start periodic updates
                    setInterval(updateLastSync, 60000);
                    setInterval(updateTime, 1000);
                    setInterval(checkNewMessages, 10000);
                    
                } else {
                    window.location.href = '/session?error=not_linked';
                }
            } catch (error) {
                console.error('Error:', error);
                window.location.href = '/session?error=invalid_session';
            }
        }
        
        // Load chats
        async function loadChats() {
            // Simulate API call
            setTimeout(() => {
                // Sample chats data
                const sampleChats = [
                    { id: '1', name: 'John Doe', lastMessage: 'Hello there!', time: '10:30', unread: 3, online: true },
                    { id: '2', name: 'Jane Smith', lastMessage: 'Are you coming?', time: '09:45', unread: 0, online: false },
                    { id: '3', name: 'Family Group', lastMessage: 'Photo sent', time: 'Yesterday', unread: 5, online: true },
                    { id: '4', name: 'Business Contact', lastMessage: 'Meeting at 3 PM', time: 'Yesterday', unread: 0, online: true }
                ];
                
                const container = document.getElementById('chatsList');
                container.innerHTML = `
                    <div class="p-4">
                        <div class="text-gray-400 text-sm font-bold mb-3">RECENT CHATS (${sampleChats.length})</div>
                        ${sampleChats.map(chat => `
                            <div class="chat-item flex items-center p-3 rounded-lg hover:bg-gray-700 cursor-pointer mb-2" 
                                 onclick="selectChat('${chat.id}')">
                                <div class="relative">
                                    <div class="w-12 h-12 ${chat.online ? 'bg-green-500' : 'bg-blue-500'} rounded-full flex items-center justify-center">
                                        <span class="font-bold">${chat.name.charAt(0)}</span>
                                    </div>
                                    ${chat.online ? '<div class="online-dot absolute bottom-0 right-0 border-2 border-gray-800"></div>' : ''}
                                </div>
                                <div class="ml-3 flex-1">
                                    <div class="font-bold">${chat.name}</div>
                                    <div class="text-sm text-gray-400 truncate">${chat.lastMessage}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-400">${chat.time}</div>
                                    ${chat.unread > 0 ? `
                                        <div class="mt-1 whatsapp-gradient text-xs rounded-full w-5 h-5 flex items-center justify-center">
                                            ${chat.unread}
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                chats = sampleChats;
            }, 1000);
        }
        
        // Select chat
        function selectChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;
            
            activeChat = chat;
            
            // Update UI
            document.getElementById('activeChatName').textContent = chat.name;
            document.getElementById('activeChatStatus').textContent = chat.online ? 'Online' : 'Last seen recently';
            
            // Enable message input
            document.getElementById('messageInput').disabled = false;
            document.getElementById('sendButton').disabled = false;
            document.getElementById('messageInput').focus();
            
            // Load messages for this chat
            loadMessages(chatId);
            
            // Mark as read
            if (chat.unread > 0) {
                chat.unread = 0;
                updateNotificationCount();
            }
            
            // Show messages section
            showSection('messages');
        }
        
        // Load messages
        async function loadMessages(chatId) {
            const container = document.getElementById('messagesContainer');
            
            // Sample messages
            const messages = [
                { id: 1, text: 'Hello! How are you?', time: '10:30 AM', sender: 'them', read: true },
                { id: 2, text: 'I\'m good, thanks! How about you?', time: '10:31 AM', sender: 'me', read: true },
                { id: 3, text: 'Doing great! Just working on some projects.', time: '10:32 AM', sender: 'me', read: true },
                { id: 4, text: 'That sounds interesting. What are you working on?', time: '10:33 AM', sender: 'them', read: true },
                { id: 5, text: 'A new WhatsApp web client with advanced features.', time: '10:34 AM', sender: 'me', read: true }
            ];
            
            container.innerHTML = messages.map(msg => `
                <div class="flex ${msg.sender === 'me' ? 'justify-end' : 'justify-start'} mb-4">
                    <div class="max-w-xs lg:max-w-md">
                        <div class="${msg.sender === 'me' ? 'message-sent' : 'message-received'} p-4">
                            <div class="text-black">${msg.text}</div>
                            <div class="text-xs ${msg.sender === 'me' ? 'text-gray-500' : 'text-gray-400'} mt-2 flex justify-end">
                                ${msg.time}
                                ${msg.sender === 'me' && msg.read ? ' <i class="fas fa-check-double text-blue-500 ml-1"></i>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }
        
        // Send message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || !activeChat) return;
            
            // Add message to UI
            const container = document.getElementById('messagesContainer');
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            container.innerHTML += `
                <div class="flex justify-end mb-4">
                    <div class="max-w-xs lg:max-w-md">
                        <div class="message-sent p-4">
                            <div class="text-black">${message}</div>
                            <div class="text-xs text-gray-500 mt-2 flex justify-end">
                                ${time} <i class="fas fa-check ml-1"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Clear input
            input.value = '';
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
            
            // Simulate reply
            setTimeout(() => {
                container.innerHTML += `
                    <div class="flex justify-start mb-4">
                        <div class="max-w-xs lg:max-w-md">
                            <div class="message-received p-4">
                                <div class="text-black">Thanks for your message!</div>
                                <div class="text-xs text-gray-400 mt-2 flex justify-end">
                                    ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.scrollTop = container.scrollHeight;
            }, 1000);
        }
        
        // Load notifications
        async function loadNotifications() {
            // Sample notifications
            notifications = [
                { id: 1, text: 'New message from John', time: '2 min ago', read: false },
                { id: 2, text: 'WhatsApp linked successfully', time: '10 min ago', read: true },
                { id: 3, text: 'New contact added', time: '1 hour ago', read: true }
            ];
            
            updateNotificationCount();
        }
        
        // Update notification count
        function updateNotificationCount() {
            const unreadCount = notifications.filter(n => !n.read).length + 
                               chats.reduce((sum, chat) => sum + chat.unread, 0);
            
            document.getElementById('notificationCount').textContent = unreadCount > 0 ? unreadCount : '';
            
            // Update notifications panel
            const list = document.getElementById('notificationsList');
            list.innerHTML = notifications.map(notif => `
                <div class="p-3 border-b border-gray-700 ${notif.read ? 'bg-gray-800' : 'bg-gray-900'}">
                    <div class="font-bold">${notif.text}</div>
                    <div class="text-xs text-gray-400">${notif.time}</div>
                </div>
            `).join('');
            
            // Update message count
            document.getElementById('messageCount').textContent = `${chats.length} chats, ${notifications.length} notifications`;
        }
        
        // Show/hide sections
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('[id$="Section"]').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(`${section}Section`).classList.remove('hidden');
            
            // Update active button
            document.querySelectorAll('.menu-btn').forEach(btn => {
                btn.classList.remove('active', 'text-green-400');
                btn.classList.add('text-gray-400');
            });
            event.target.classList.add('active', 'text-green-400');
        }
        
        // Toggle notifications panel
        function toggleNotifications() {
            const panel = document.getElementById('notificationsPanel');
            panel.classList.toggle('hidden');
        }
        
        // Clear notifications
        function clearNotifications() {
            notifications.forEach(n => n.read = true);
            updateNotificationCount();
        }
        
        // Toggle auto-reply settings
        document.getElementById('autoReplyToggle').addEventListener('change', function() {
            const settings = document.getElementById('autoReplySettings');
            settings.classList.toggle('hidden', !this.checked);
        });
        
        // Save auto-reply
        function saveAutoReply() {
            const message = document.getElementById('autoReplyMessage').value;
            alert('Auto-reply saved: ' + message);
        }
        
        // Export chats
        function exportChats(format) {
            alert(`Exporting chats as ${format.toUpperCase()}...`);
        }
        
        // Logout
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                window.location.href = '/';
            }
        }
        
        // Delete session
        function deleteSession() {
            if (confirm('This will permanently delete your session. Are you sure?')) {
                window.location.href = '/';
            }
        }
        
        // Format phone number
        function formatPhoneNumber(phone) {
            return phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1 $2 $3');
        }
        
        // Update time
        function updateTime() {
            document.getElementById('currentTime').textContent = 
                new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // Update last sync
        function updateLastSync() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastSync').textContent = timeStr;
        }
        
        // Check for new messages
        function checkNewMessages() {
            // Simulate new message notification
            if (Math.random() > 0.7 && chats.length > 0) {
                const randomChat = chats[Math.floor(Math.random() * chats.length)];
                randomChat.unread++;
                
                addNotification(`New message from ${randomChat.name}`);
                updateNotificationCount();
            }
        }
        
        // Add notification
        function addNotification(text) {
            notifications.unshift({
                id: Date.now(),
                text: text,
                time: 'Just now',
                read: false
            });
        }
        
        // Copy phone
        function copyPhone() {
            navigator.clipboard.writeText(currentSession.phoneNumber);
            alert('Phone number copied!');
        }
        
        // Copy session
        function copySession() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session');
            navigator.clipboard.writeText(sessionId);
            alert('Session ID copied!');
        }
        
        // Toggle sidebar on mobile
        function toggleSidebar() {
            document.querySelector('.w-80').classList.toggle('hidden');
            document.querySelector('.w-80').classList.toggle('absolute');
            document.querySelector('.w-80').classList.toggle('z-40');
        }
        
        // New chat modal
        function newChat() {
            document.getElementById('newChatModal').classList.remove('hidden');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
        
        function createNewChat() {
            const input = document.getElementById('newChatInput').value;
            if (input) {
                alert(`Starting chat with: ${input}`);
                closeModal('newChatModal');
            }
        }
        
        // Import contacts
        function importContacts() {
            alert('Contact import feature coming soon!');
        }
        
        // Show settings
        function showSettings() {
            showSection('settings');
        }
        
        // Initialize when page loads
        window.onload = function() {
            initDashboard();
            
            // Handle Enter key for sending messages
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Handle search
            document.getElementById('searchChats').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                // Implement search functionality here
            });
        };
    </script>
</body>
</html>